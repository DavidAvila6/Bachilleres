{% extends "base.html" %}


{% block content %}
<div class="container mt-4">
  <h1 class="text-center">Foro de Usuarios</h1>

  <!-- Reglas del Foro -->
  <div class="alert alert-info">
    <h3>Reglas del Foro General</h3>
    <ul>
      <li>Se respetuoso y cortés con los demás miembros del foro.</li>
      <li>No se permite contenido ofensivo, difamatorio o ilegal.</li>
      <li>No hagas spam o publiques enlaces no relacionados.</li>
      <li>Mantén las discusiones en los temas apropiados.</li>
    </ul>
  </div>

  <div class="text-right mb-3">
    <a class="btn btn-success" href="{% url 'crear_publicacion' %}">Crear Publicación</a>
  </div>

  <ul class="list-group">
    {% for publicacion in publicaciones %}
    <li class="list-group-item mb-3 publicacion-item">
      <div>
        <h2 class="h4">{{ publicacion.titulo }}</h2>
        <div class="publicacion-content">
          <p>{{ publicacion.contenido }}</p>
        </div>
        <p class="mb-2">Publicado por: {{ publicacion.autor.username }} el {{ publicacion.fecha_creacion }}</p>
        {% if request.user == publicacion.autor %}
        <a href="{% url 'eliminar_publicacion' publicacion.id %}" class="btn btn-danger btn-sm">Eliminar Publicación</a>
        {% endif %}
        <!-- Mostrar la cantidad de comentarios -->
        <p class="mb-1">Comentarios ({{ publicacion.num_comentarios }})</p>
        
        <!-- Iterar sobre los comentarios -->
        <ul class="list-group comentarios-list">
          {% for comentario in publicacion.comentarios %}
          <li class="list-group-item mb-2 comentario-item">
            <p>{{ comentario.contenido }}</p>
            <p class="mb-1">Comentado por: {{ comentario.autor.username }} el {{ comentario.fecha_creacion }}</p>
            {% if request.user == comentario.autor %}
            <a href="{% url 'eliminar_comentario' comentario.id %}" class="btn btn-danger btn-sm">Eliminar Comentario</a>
            {% endif %}
          </li>
          {% empty %}
          <li class="list-group-item">No hay comentarios disponibles.</li>
          {% endfor %}
        </ul>
        
        <!-- Enlace para agregar un comentario -->
        <a href="{% url 'agregar_comentario' publicacion.id %}" class="btn btn-primary btn-sm mt-2">Agregar Comentario</a>
      </div>
    </li>
    {% empty %}
    <li class="list-group-item">No hay publicaciones disponibles.</li>
    {% endfor %}
  </ul>
  
  <a href="forosFacultades/">Foros Específicos</a> - Aquí puedes encontrar discusiones y temas relacionados con facultades específicas.
</div>
{% load static %}
    <link rel="stylesheet" href="../static/css/hub.css ">
    <script src="../static/js/hub.js"></script>
<input type="checkbox" id="btn-modal">
    <div class="container-modal" >
        <div class="content-modal">
            <h2> ¡Bienvenido al foro !</h2>
            <p>Este es el lugar donde puedes compartir tus ideas, preguntas y opiniones sobre una amplia variedad de temas. 
              Interactúa con otros usuarios y recibe respuestas de la comunidad y nuestros administradores. 
              ¡Únete a la conversación y forma parte de esta comunidad en constante crecimiento!
            </p>
            <div class="btn-cerrar">
                <label for="btn-modal">cerrar</label>
            </div>
            <!--
            <div class="btn-siguiente">

            <button class="button-redireccionar" onclick="window.location.href='/foro'">Siguiente</button>
            </div>
            -->
        </div>
        
    </div>
<style>
  /* Estilos personalizados */
  .publicacion-item:hover {
    background-color: #f5f5f5;
    transform: scale(1.02);
  }

  .comentario-item:hover {
    background-color: #f0f0f0;
    transform: scale(1.02);
  }

  .publicacion-content {
    background-color: #f0f0f0;
    padding: 10px;
    border-radius: 5px;
    transition: height 0.3s; /* Agregamos una transición de altura */
  }

  .comentarios-list {
    border: 1px solid #ddd;
    border-radius: 5px;
  }
</style>
{% endblock %}

<script>
  // Obtenemos todos los botones de "Mostrar Comentarios"
  const toggleButtons = document.querySelectorAll(".toggle-comments");

  // Agregamos un manejador de eventos para cada botón
  toggleButtons.forEach((button) => {
    button.addEventListener("click", (event) => {
      // Encuentra la lista de comentarios asociada a este botón
      const comentariosList = event.target.nextElementSibling;

      // Alternar la visibilidad de los comentarios
      if (comentariosList.style.display === "none" || comentariosList.style.display === "") {
        comentariosList.style.display = "block";
        event.target.textContent = "Ocultar Comentarios";
      } else {
        comentariosList.style.display = "none";
        event.target.textContent = "Mostrar Comentarios";
      }
    });
  });
</script>
